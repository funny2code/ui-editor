<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Grapesjs Project Manager</title>
    <link href="https://unpkg.com/grapesjs/dist/css/grapes.min.css" rel="stylesheet">
    <link rel="stylesheet" href="static/dist_/grapesjs-project-manager.min.css">
    <script src="https://unpkg.com/grapesjs"></script>
    <script src="https://unpkg.com/grapesjs-blocks-basic"></script>
    <script src="https://unpkg.com/grapesjs-preset-webpage"></script>
    <style>
        body,
        html {
            height: 100%;
            margin: 0;
        }
        .panel__top {
            padding: 0;
            width: 100%;
            display: flex;
            position: initial;
            justify-content: center;
            justify-content: space-between;
        }
        .panel__basic-actions {
            position: initial;
        }
    </style>
</head>

<body>
    <div class="panel__top">
        <div class="panel__basic-actions"></div>
        <div>
            <label for="">pages</label>
            <select name="pages_manager" id="pages_manager">
                
            </select>
        </div>
    </div>
    <div id="gjs" style="height:0px; overflow:hidden">
        
    </div>

    <script type="text/javascript">
        const editor = grapesjs.init({
            // Indicate where to init the editor. You can also pass an HTMLElement
            container: '#gjs',
            // Get the content for the canvas directly from the element
            // As an alternative we could use: `components: '<h1>Hello World Component!</h1>'`,
            fromElement: true,
            // Size of the editor
            height: '100%',
            width: 'auto',
            // Disable the storage manager for the moment
            storageManager: false,
            // Avoid any default panel
            panels: { defaults: [] },
            plugins: ['grapesjs-project-manager', 'gjs-blocks-basic', "grapesjs-preset-webpage"],
            pageManager: {
                pages: [{
                    id: 'page-1',
                    name: 'Page 1',
                    component: '<div id="comp1">Page 1</div>',
                    styles: '#comp1 { color: red }',
                }, {
                    id: 'page-2',
                    name: 'Page 2',
                    component: '<div id="comp2">Page 2</div>',
                    styles: '#comp2 { color: green }',
                }, {
                    id: 'page-3',
                    name: 'Page 3',
                    component: '<div id="comp3">Page 3</div>',
                    styles: '#comp3 { color: blue }',
                }]
            },
        });
        editor.Panels.addPanel({
            id: 'panel-top',
            el: '.panel__top',
        });
        editor.Panels.addPanel({
            id: 'basic-actions',
            el: '.panel__basic-actions',
            buttons: [                {
                id: 'visibility',
                active: true, // active by default
                className: 'btn-toggle-borders',
                label: '<u>B</u>',
                command: 'sw-visibility', // Built-in command
            }, {
                id: 'export',
                className: 'btn-open-export',
                label: 'Exp',
                command: 'export-template',
                context: 'export-template', // For grouping context of buttons from the same panel
            }, {
                id: 'show-json',
                className: 'btn-show-json',
                label: 'JSON',
                context: 'show-json',
                command(editor) {
                    editor.Modal.setTitle('Components JSON')
                    .setContent(`<textarea style="width:100%; height: 250px;">
                        ${JSON.stringify(editor.getComponents())}
                    </textarea>`)
                    .open();
                },
            }],
        });
        const pages = editor.Pages;
        console.log("All Pages: ", pages.getAll());

        const selectedPage = pages.getSelected();
        console.log("Selected Page: ", selectedPage);

        const newPage = pages.add({
            id: "new-page-id",
            name: "custom page",
            styles: '.my-class {color : red}',
            component: '<div class="my-class">My element</div>',
        });
        // pages.select('new-page-id');
        console.log("All Pages: ", pages.getAll());
        editor.onReady(() => {
            console.log("=======================")
            allpages = pages.getAll();
            for (page of allpages) {
                console.log("Page: ", page)
                let page_id = page.id;
                document.querySelector("#pages_manager").insertAdjacentHTML('beforeend',`<option value="${page_id}">${page.get('name')}</option>`)        ;
            }
        })
        document.querySelector("#pages_manager").addEventListener("change", function(e) {
            let id = this.value;
            pages.select(id);
        })
    </script>
</body>

</html>